---
import headerDataRaw from '../data/header.json';

type ContactItem = {
    label: string;
    url: string;
    display: string;
};

type Client = {
    name: string;
    url: string | null;
};

type Experience = {
    name: string;
    city: string;
    url: string | null;
    year: string;
};

interface HeaderData {
    name: string;
    tagline: string;
    contact: ContactItem[];
    clients: Client[];
    experience: Experience[]; // This tells TS exactly what to expect
}

const headerData = headerDataRaw as HeaderData;
---

<div class="relative flex flex-col gap-4">
    <div>
        <p>{headerData.name}</p>
        <p>{headerData.tagline}</p>
    </div>
    <div>
        <p class="text-xs">Contact</p>
        {headerData.contact.map((item: ContactItem) => (
            <p>
                <a href={item.url}>{item.display}</a>
            </p>
        ))}
    </div>
    <div>
        <p class="text-xs">Clients</p>
        <ul>
            {headerData.clients.map((client: Client) => (
                <li>
                    {client.url ? (
                        <a href={client.url}>{client.name}</a>
                    ) : (
                        <p>{client.name}</p>
                    )}
                </li>
            ))}
        </ul>
    </div>
    <div>
        <p class="text-xs">Experience</p>
        <ul>
            {headerData.experience.map((exp) => (
                <li>
                    {exp.url ? (
                        <a href={exp.url}>{exp.name}</a>
                    ) : (
                        <span>{exp.name}</span>
                    )}
                    <span>({exp.year}) ({exp.city})</span>
                </li>
            ))}
        </ul>
        <div>
            <button id="size-toggle" class="absolute right-0 bottom-0 hover:opacity-60 transition-opacity cursor-pointer">M</button>
        </div>
    </div>
</div>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const sizeButton = document.getElementById("size-toggle");
        const isMobile = () => window.innerWidth < 768;
        
        // Mobile: S/M only, Desktop: S/M/L/XL
        const getSizes = () => isMobile() ? ["S", "M"] : ["S", "M", "L", "XL"];
        
        function getSizeHeights() {
            const vh = window.innerHeight;
            
            if (isMobile()) {
                return {
                    "S": Math.round(vh * 0.30),
                    "M": Math.round(vh * 0.45)
                };
            }
            
            return {
                "S": 180,
                "M": 300,
                "L": 450,
                "XL": 580
            };
        }

        let currentSizeIndex = 1; // Start at M

        function updateButton() {
            const sizes = getSizes();
            const sizeHeights = getSizeHeights();
            const currentSize = sizes[currentSizeIndex];
            
            sizeButton.textContent = currentSize;

            window.dispatchEvent(new CustomEvent("sliderSizeChange", {
                detail: {
                    size: currentSize,
                    height: sizeHeights[currentSize]
                }
            }));
        }

        sizeButton?.addEventListener("click", (e) => {
            e.preventDefault();
            const sizes = getSizes();
            currentSizeIndex = (currentSizeIndex + 1) % sizes.length;
            updateButton();
        });

        // Handle resize between mobile/desktop
        let lastIsMobile = isMobile();
        window.addEventListener("resize", () => {
            const nowMobile = isMobile();
            if (lastIsMobile !== nowMobile) {
                // Reset to M when switching between mobile/desktop
                currentSizeIndex = 1;
                lastIsMobile = nowMobile;
                updateButton();
            }
        });
    });
</script>